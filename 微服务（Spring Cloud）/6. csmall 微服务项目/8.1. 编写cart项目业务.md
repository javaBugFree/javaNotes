
cart模块能够正常启动,但是还没有任何业务  
  
结合我们最终生成订单的业务  
  
当前cart模块需要开发如下两个功能  
1.新增购物车中商品  
2.删除购物车中商品


### 1. 开发持久层

创建mapper包，包中创建 *mapper.CartMapper* 接口，中编写两个方法  
一个新增购物车
一个删除购物车  
  
```java  
/**  
 * 购物车数据 mapper接口  
 * 持久层  
 */  
@Repository  
public interface CartMapper {  
  
    /**  
     * 向购物车中新增商品  
     *  
     * @param cart 购物车商品数据  
     * @return 受影响的行数  
     */  
    @Insert("INSERT INTO cart_tbl(commodity_code, price, count, user_id)" +  
            "VALUES(#{commodityCode}, #{price}, #{count}, #{userId})")  
    int insertCart(Cart cart);  
  
  
    @Delete("DELETE FROM cart_tbl WHERE user_id = #{user_id} AND commodity_code = #{commodityCode}")  
    int deleteByUserIdAndCommodityCode(@Param("userId") String userId,  
                                       @Param("commodityCode") String commodityCode);  
  
}
```


### 2. 开发业务逻辑层

创建service包，包中创建 *CartService* 接口
  
接口中编写新增和删除购物车的两个业务逻辑层方法声明：
```java
/**  
 * 业务逻辑层  
 */  
@Transactional  
public interface CartService {  
  
    /**  
     * 新增购物车商品的业务逻辑层方法  
     *  
     * @param cartAddDTO 新增购物车商品的数据  
     */  
    void cartAdd(CartAddDTO cartAddDTO);  
  
    /**  
     * 删除购物车商品  
     *  
     * @param userId        用户id  
     * @param commodityCode 商品编码  
     */  
    void deleteUserCart(String userId, String commodityCode);  
  
}
```

在service包中创建impl包，然后创建 *CartServiceImpl*类，编写业务实现类
```java
@Slf4j  
@Service  
public class CartServiceImpl implements CartService {  
  
    @Autowired  
    private CartMapper cartMapper;  
  
    @Override  
    public void cartAdd(CartAddDTO cartAddDTO) {  
        log.info("开始处理【添加购物车商品】的业务，参数：{}", cartAddDTO);  
  
        Cart cart = new Cart();  
        BeanUtils.copyProperties(cartAddDTO, cart);  
  
        int insert = cartMapper.insertCart(cart);  
        // 下面可以根据insert的值判断是否添加成功  
  
        log.info("购物车中新增了商品：{}", cart);  
    }  
  
    @Override  
    public void deleteUserCart(String userId, String commodityCode) {  
  
        int delete = cartMapper.deleteByUserIdAndCommodityCode(userId, commodityCode);  
  
        log.info("购物车中商品已移除！");  
    }  
}
```


如果需要设置日志输出级别，dev的yml文件中添加：
```yaml
logging:
  level:
    cn.tedu.csmall.cart: debug
```


### 3. 开发控制层

创建controller包，包中创建*CartController*类，代码如下：
```java
@Slf4j  
@RestController  
@RequestMapping("/base/card")  
@Api(tags = "1.购物车管理模块")  
@Validated  
public class CartController {  
  
    @Autowired  
    private CartService cartService;  
  
  
    @PostMapping("/add")  
    @ApiOperation("新增商品到购物车")  
    @ApiOperationSupport(order = 100)  
    public JsonResult<Void> add(CartAddDTO cartAddDTO) {  
        cartService.cartAdd(cartAddDTO);  
        return JsonResult.ok("新增商品到购物车完成！");  
    }  
  
    @PostMapping("/delete")  
    @ApiOperation("删除购物车中的商品")  
    @ApiOperationSupport(order = 200)  
    @ApiImplicitParams({  
            @ApiImplicitParam(name = "userId", value = "用户id", example = "UU100"),  
            @ApiImplicitParam(name = "commodityCode", value = "商品id", example = "PC100")  
    })  
    public JsonResult<Void> delete(String userId, String commodityCode) {  
        cartService.deleteUserCart(userId, commodityCode);  
        return JsonResult.ok("删除购物车中的商品成功！");  
    }  
  
}
```

重启cart模块，localhost:20001/doc.html   

测试：
发送新增购物车的请求测试  
然后测试删除购物车的功能