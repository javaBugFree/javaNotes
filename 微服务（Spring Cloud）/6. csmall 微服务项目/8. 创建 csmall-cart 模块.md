
## 1. 创建项目  
  
创建csmall-cart子项目，功能是**购物车的管理**
  
1. 父子相认
子项目pom文件为:  
```xml
<?xml version="1.0" encoding="UTF-8"?>  
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">  
    <modelVersion>4.0.0</modelVersion>  
    <parent>  
        <groupId>cn.tedu</groupId>  
        <artifactId>csmall</artifactId>  
        <version>0.0.1-SNAPSHOT</version>  
        <relativePath/> <!-- lookup parent from repository -->  
    </parent>  
    <groupId>cn.tedu</groupId>  
    <artifactId>csmall-cart</artifactId>  
    <version>0.0.1-SNAPSHOT</version>  
    <name>csmall-cart</name>  
    <description>csmall-cart</description>  
  
    <dependencies>  
        <!--web实例-->  
        <dependency>  
            <groupId>org.springframework.boot</groupId>  
            <artifactId>spring-boot-starter-web</artifactId>  
        </dependency>  
        <!--mybatis整合springboot-->  
        <dependency>  
            <groupId>org.mybatis.spring.boot</groupId>  
            <artifactId>mybatis-spring-boot-starter</artifactId>  
        </dependency>  
        <!--alibaba 数据源德鲁伊-->  
        <dependency>  
            <groupId>com.alibaba</groupId>  
            <artifactId>druid</artifactId>  
        </dependency>  
        <!--mysql驱动-->  
        <dependency>  
            <groupId>mysql</groupId>  
            <artifactId>mysql-connector-java</artifactId>  
        </dependency>  
        <!--all-common依赖-->  
        <dependency>  
            <groupId>cn.tedu</groupId>  
            <artifactId>csmall-commons</artifactId>  
            <version>0.0.1-SNAPSHOT</version>  
        </dependency>  
        <!--在线api文档-->  
        <dependency>  
            <groupId>com.github.xiaoymin</groupId>  
            <artifactId>knife4j-spring-boot-starter</artifactId>  
        </dependency>  
        <!--  Nacos注册依赖 -->  
        <dependency>  
            <groupId>com.alibaba.cloud</groupId>  
            <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>  
        </dependency>  
  
    </dependencies>  
  
</project>
```
  
删除test文件夹
删除application.properties配置文件

2. **配置文件**

创建 *application.yml* 文件，内容如下：
- **注意修改了端口号20001**
```yml
server:  
  port: 20001  
#公共配置  
mybatis:  
  configuration:  
    # 不启用mybatis缓存  
    cache-enabled: false    # 默认值  
    # 映射支持驼峰命名法  
    map-underscore-to-camel-case: true    # 默认值  
    # 将运行的sql输出到控制台，区别于设置显示日志级别的另一种方法  
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl  
knife4j:  
  # 开启增强配置  
  enable: true  
  # 生产环境屏蔽，开启将禁止访问在线API文档  
  production: false  
  
  # Basic认证功能，即是否需要通过用户名、密码验证后才可以访问在线API文档  
  basic:  
    # 是否开启Basic认证  
    enable: false  
    # 用户名，如果开启Basic认证却未配置用户名与密码，默认是：admin/123321  
    username: root  
    # 密码  
    password: root  
spring:  
  profiles:  
    active: dev
```

*application-dev.yml* 也可以粘贴过来，
- 修改项目名称为：`nacos-cart`
```yml
spring:  
  application:  
    # 设置当前项目的名称，这个名字会提交给Nacos做当前微服务项目的名称  
    name: nacos-cart  
  cloud:  
    nacos:  
      discovery:  
        # 配置 Nacos的位置，用于提交当前新项目信息  
        server-addr: localhost:8848  
        # ephemeral设置当前项目启动时注册到nacos的类型 true(默认):临时实例 false:永久实例  
        # ephemeral: false  
  datasource:  
    url: jdbc:mysql://localhost:3306/csmall_db?useSSL=false&useUnicode=true&characterEncoding=utf-8&serverTimezone=Asia/Shanghai&allowMultiQueries=true  
    username: root  
    password: root
```


## 2. 准备数据

我们cart模块需要连接数据库操作，所以我们要创建需要的表和添加表中的数据  

推荐大家学习使用数据库的**专用可视化工具**来操作数据库：
**heidiSQL**(*安装MariaDB自带的*)*免费*的，如果电脑安装的不是MariaDB，而是mysql的话,可能没有这个工具。
  
heidiSQL下载地址:  
https://www.heidisql.com/download.php
可以上网搜索mysql可视化工具解决，例如SQLYog和Navicat。

sql代码已经发送在csmall-finish项目的*note文件夹*中：csmall_db.sql。运行其中的sql代码即可：
```sql  
CREATE DATABASE  IF NOT EXISTS `csmall_db` DEFAULT CHARACTER SET utf8mb4;  
USE `csmall_db`;  
  
DROP TABLE IF EXISTS `cart_tbl`;  
  
CREATE TABLE `cart_tbl` (  
                            `id` int NOT NULL AUTO_INCREMENT COMMENT '购物车id',  
                            `commodity_code` varchar(255) DEFAULT NULL COMMENT '商品编码',  
                            `price` int DEFAULT '0' COMMENT '商品单价',  
                            `count` int DEFAULT '0' COMMENT '购买数量',  
                            `user_id` varchar(255) DEFAULT NULL COMMENT '用户id',  
                            PRIMARY KEY (`id`),                            UNIQUE KEY `commodity_code` (`commodity_code`)) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb3;  
  
  
insert  into `cart_tbl`(`id`,`commodity_code`,`price`,`count`,`user_id`) values  
(1,'PU201',500,10,'UU100');  
  
  
DROP TABLE IF EXISTS `order_tbl`;  
  
CREATE TABLE `order_tbl` (  
                             `id` int NOT NULL AUTO_INCREMENT COMMENT '订单id',  
                             `user_id` varchar(255) DEFAULT NULL COMMENT '用户id',  
                             `commodity_code` varchar(255) DEFAULT NULL COMMENT '商品编码,也可以是商品id',  
                             `count` int DEFAULT '0' COMMENT '购买这个商品的数量',  
                             `money` int DEFAULT '0' COMMENT '订单金额',  
                             PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=27 DEFAULT CHARSET=utf8mb3;  
  
insert  into `order_tbl`(`id`,`user_id`,`commodity_code`,`count`,`money`) values  
(22,'UU100','PU201',10,200),  
(23,'UU100','PU201',10,200),  
(24,'UU100','PU201',10,200),  
(25,'UU100','PU201',10,200);  
  
  
DROP TABLE IF EXISTS `stock_tbl`;  
  
CREATE TABLE `stock_tbl` (  
                             `id` int NOT NULL AUTO_INCREMENT COMMENT '商品id',  
                             `commodity_code` varchar(255) DEFAULT NULL COMMENT '商品编码',  
                             `count` int DEFAULT '0' COMMENT '商品库存',  
                             PRIMARY KEY (`id`),                             UNIQUE KEY `commodity_code` (`commodity_code`)) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb3;  
  
insert  into `stock_tbl`(`id`,`commodity_code`,`count`) values  
(1,'PU201',990);  
  
DROP TABLE IF EXISTS `undo_log`;  
  
CREATE TABLE `undo_log` (
							`id` bigint NOT NULL AUTO_INCREMENT,  
							`branch_id` bigint NOT NULL,  
							`xid` varchar(100) NOT NULL,  
							`context` varchar(128) NOT NULL,  
							`rollback_info` longblob NOT NULL,  
							`log_status` int NOT NULL,  
							`log_created` datetime NOT NULL,  
							`log_modified` datetime NOT NULL,  
							PRIMARY KEY (`id`),  
							UNIQUE KEY `ux_undo_log` (`xid`,`branch_id`)
) ENGINE=InnoDB AUTO_INCREMENT=68 DEFAULT CHARSET=utf8mb3;
```



## 3. Spring相关配置类

和business项目一样，我们需要创建config包，包中创建相关配置类：

- *CommonsConfiguration*
  
- *knife4j配置*
    - 注意包名

- 当前cart模块除了上述配置之外，还需要添加Mybatis扫描mapper包的配置  
    - config包中再创建一个*MyBatisConfiguration*类，代码如下：
        ```java
        /**  
		 * Mybatis配置类  
		 */  
		@Configuration  
		// Mybatis框架要求扫描指定的包，包中的接口会生成实现类  
		@MapperScan("cn.tedu.csmall.cart.mapper")  
		public class MybatisConfiguration {  
		}
		```

我们尝试启动Nacos后，启动cart模块，观察nacos服务列表中是否包含当前服务名称。