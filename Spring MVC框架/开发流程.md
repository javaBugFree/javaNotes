
**建议的开发流程**仍是：Mapper层 > Service层 > Controller层 > 前端层

**SpringMVC**：
M：model，数据处理模型，*Service + Mapper*。
V：View，视图。
C：*Controller*。

**各层的作用和代码内容**：
*Mapper层*：数据的访问，对数据的增删改查。
*Service层*：设计业务流程和业务逻辑。
*Controller层*：接收请求和响应结果。

**始终一次只解决一个问题！** 不相关的先不管。

- **注意：** 
    - 每层开发完成后，都应该及时测试，
    - **Mapper层、Service层** 都可以通过 **测试类** 中的 *测试方法* 进行测试，
    - **Controller层** 可以通过 **API文档** 的 *调试功能* 进行测试。
    - 整个后端项目可以通过 **侧边栏maven**里的 *生命周期 里的 test* 进行整个项目的测试。
        - *clean* 可以*清空测试日志*，推荐测试前清空一下，以免之前的测试信息会影响。
        - 测试日志会存放在 *target/surefire-reports* 中。里面会存放测试日志，如果测试时发生错误，在对应的日志文件里面会体现。


![[SpringMVC开发流程.jpg]]


# 开发流程套路

## 关于Mapper层
  
添加属性模板的本质是向“属性模板表”中插入数据，此前已经完成此功能。

如果制定的业务规则包括“属性模板的名称必须唯一”，在插入数据之前，还应该检查此名称有没有被占用，可以通过“根据属性模板名称统计数据的数量”来实现检查，此前已经完成此功能。

<hr>

## 关于Service层  
  
### 创建必要的POJO类型
  
添加数据或修改数据大多需要创建对应的POJO类型。

在项目的根包下创建`pojo.dto.AttributeTemplateAddNewDTO`类，在类中声明客户端提交请求时必须提交的参数对应的属性，并实现 *Serializable 接口*：
```java
@Data
public class AttributeTemplateAddNewDTO implements Serializable{
    private String name;
    private String pinyin;
    private String keywords;
    private Integer sort;
}
```

<br>

### 创建必要的业务接口，并声明抽象方法

在项目的根包下创建`service.AttributeTemplateService`接口，并在接口中声明抽象方法：
```java
public interface IAttributeTemplateService {
    void addNew(AttributeTemplateAddNewDTO attributeTemplateAddNewDTO);
}
```

<br>

### 创建必要的业务实现类，并重写业务方法（抽象方法）

在项目的根包下创建`service.impl.AttributeTemplateServiceImpl`类，实现以上接口，在类上添加`@Service`注解，在类的内部自动装配`AttributeTemplateMapper`类型的属性：

```java
@Service
public class AttributeTemplateServiceImpl implements AttributeTemplateService {
    @Autowired
    private AttributeTemplateMapper attributeTemplateMapper;
    
    @Override
    public void addNew(AttributeTemplateAddNewDTO attributeTemplateAddNewDTO) {
	    
    }
}
```  

关于业务方法的实现：
```java
@Override
public void addNew(AttributeTemplateAddNewDTO attributeTemplateAddNewDTO) {
   // 从参数对象中取出“属性模板的名称”
    // 调用Mapper对象的“根据名称统计数量”执行统计
    // 判断统计结果是否大于0
    // 是：表示名称已经被占用，则抛出异常（ERR_CONFLICT）
    // 创建AttributeTemplate实体类的对象
    // 通过BeanUtils.copyProperties()方法将参数对象中的属性值复制到实体类型对象中
    // 调用Mapper对象的“插入数据”方法
}
```

<br>

### 创建必要的测试类，编写并执行测试方法
  
在`src/test/java`下的根包下创建`service.AttributeTemplateServiceTests`测试类，在类上添加`@Slf4j`和`@SpringBootTest`注解，在类中自动装配`AttributeTemplateService`接口类型的属性：
  
```java
@Slf4j
@SpringBootTest
public class AttributeTemplateServiceTests {
    @Autowired
    AttributeTemplateService service;
}
```

然后，编写并执行测试方法：
```java
@Test
void addNew() {
    AttributeTemplateAddNewDTO attributeTemplate = new AttributeTemplateAddNewDTO();
    attributeTemplate.setName("测试数据001");
        try {
	        service.addNew(attributeTemplate);
	        log.debug("测试通过！");
	    } catch (ServiceException e) {
		    log.debug(e.getMessage());
	    }
}
```



