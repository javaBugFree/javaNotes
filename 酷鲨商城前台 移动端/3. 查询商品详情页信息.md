
上面章节完成了根据分类id查询spu列表  

在商品列表中选中商品后，会显示这个商品的详情信息
  
**商品详情页**我们需要显示的信息包括：
* 根据spuId查询spu信息  
* 根据spuId查询spuDetail详情  
* 根据spuId查询当前Spu包含的所有属性  
* 根据spuId查询对应的sku列表  
  
其中根据spuId查询当前Spu包含的所有属性功能涉及了一个比较复杂的 **连表查询**
根据spuId查询参数选项的*思路*：
1.根据spu_id去pms_spu表查询category_id  
2.根据category_id去pms_category表查询分类对象  
3.根据category_id去pms_category_attribute_template表查询attribute_template_id  
4.根据attribute_template_id去pms_attribute_template表查询attribute_template数据行
5.根据attribute_template_id去pms_attribute表查询对应所有属性信息行  
> 实际上,上面的联表查询可以简化为3表联查,结果相同

运行参考 *sql语句* 如下：
```sql
SELECT  
   pa.id,  pa.template_id, pa.name,   
   pa.description,         pa.type,   
   pa.value_list,          pa.unit
FROM pms_spu ps  
JOIN pms_category pc  ON ps.category_id=pc.id  
JOIN pms_category_attribute_template pcat ON pcat.category_id=pc.id  
JOIN pms_attribute_template pat ON pat.id=pcat.attribute_template_id  
JOIN pms_attribute pa ON pat.id=pa.template_id  
WHERE ps.id=1
```


## 业务逻辑层

下面进行业务内容的编写，在FrontProductServiceImpl实现类中，将未实现的4个方法实现
```java
@Slf4j  
@Service  
public class FrontProductServiceImpl implements IFrontProductService {  
  
    @DubboReference  
    private IForFrontSpuService dubboSpuService;  
    // 根据spuId查询sku列表用的对象  
    @DubboReference  
    private IForFrontSkuService dubboSkuService;  
    // 根据spuId查询所有规格Attribute的对象  
    @DubboReference  
    private IForFrontAttributeService dubboAttributeService;  
  
    // 根据分类id分页查询spu列表  
    @Override  
    public JsonPage<SpuListItemVO> listSpuByCategoryId(Long categoryId, Integer page, Integer pageSize) {  
        /*  
            这里dubbo调用的方法是已经进行了分页逻辑的  
            所以获取的直接是jsonPage类型对象，我们只需要调用然后返回即可  
         */        JsonPage<SpuListItemVO> jsonPage = dubboSpuService.listSpuByCategoryId(categoryId, page, pageSize);  
  
        return jsonPage;  
    }  
  
    // spu表，根据spuId查询spu商品详情  
    @Override  
    public SpuStandardVO getFrontSpuById(Long id) {  
        SpuStandardVO spuById = dubboSpuService.getSpuById(id);  
  
        return spuById;  
    }  
  
    // sku表，根据SpuId查询当前商品包含的sku列表  
    @Override  
    public List<SkuStandardVO> getFrontSkusBySpuId(Long spuId) {  
  
        List<SkuStandardVO> list = dubboSkuService.getSkusBySpuId(spuId);  
  
        return list;  
    }  
  
    // spu_detail表，根据spuId查询当前商品详情（展示图片）  
    @Override  
    public SpuDetailStandardVO getSpuDetail(Long spuId) {  
        SpuDetailStandardVO spuDetailById = dubboSpuService.getSpuDetailById(spuId);  
        return spuDetailById;  
    }  
  
    // 根据spuId查询当前商品所有规格选项  
    @Override  
    public List<AttributeStandardVO> getSpuAttributesBySpuId(Long spuId) {  
        List<AttributeStandardVO> list = dubboAttributeService.getSpuAttributesBySpuId(spuId);  
  
        return list;  
    }  
}
```

上面的实现类其实就是业务逻辑层正常调用dubbo方法即可


## 控制器层

FrontSpuController添加两个方法：
* 根据spuId查询spu信息  
* 根据spuId查询参数列表的
```java
// localhost:10004/front/spu/1  
@GetMapping("/{spuId}")  
@ApiOperation("根据spuId查询spu信息")  
@ApiImplicitParam(name = "spuId", value = "spuId", example = "2")  
public JsonResult<SpuStandardVO> getFrontSpuById(@PathVariable Long spuId) {  
    SpuStandardVO spuStandardVO = productService.getFrontSpuById(spuId);  
  
    return JsonResult.ok(spuStandardVO);  
}  
  
// localhost:10004/front/spu/template/1  
@GetMapping("/template/{id}")  
@ApiOperation("根据spuId查询商品的所有规格属性")  
@ApiImplicitParam(name = "id", value = "spuId", example = "1")  
public JsonResult<List<AttributeStandardVO>> getAttributeBySpuId(@PathVariable Long id) {  
    List<AttributeStandardVO> list = productService.getSpuAttributesBySpuId(id);  
    return JsonResult.ok(list);  
}
```


创建 *FrontSkuController* 并添加一个方法  
* 根据spuId查询sku列表
```java
@Slf4j  
@RestController  
@RequestMapping("/front/sku")  
@Api(tags = "前台商品sku模块")  
public class FrontSkuController {  
  
    @Autowired  
    private IFrontProductService frontProductService;  
  
    // localhost:10004/front/sku/1  
    @GetMapping("{spuId}")  
    @ApiOperation("根据spuId查询sku列表")  
    @ApiImplicitParam(name = "spuId", value = "spuId", example = "1")  
    public JsonResult<List<SkuStandardVO>> getSkuListBySpuId(@PathVariable Long spuId){  
        List<SkuStandardVO> list = frontProductService.getFrontSkusBySpuId(spuId);  
  
        return JsonResult.ok(list);  
    }  
      
}
```


*FrontSpuDetailController* 添加一个方法
* 根据spuId查询spuDetail
```java
@Slf4j  
@RestController  
@RequestMapping("/front/spu/detail")  
@Api(tags = "前台商品spuDetail详情模块")  
public class FrontSpuDetailController {  
  
    @Autowired  
    private IFrontProductService frontProductService;  
  
    @GetMapping("/{spuId}")  
    @ApiOperation("根据spuId查询spuDetail详情")  
    @ApiImplicitParam(name = "spuId", value = "spuId", example = "1")  
    public JsonResult<SpuDetailStandardVO> getSpuDetailBySpuId(@PathVariable Long spuId) {  
        SpuDetailStandardVO spuDetail = frontProductService.getSpuDetail(spuId);  
  
        return JsonResult.ok(spuDetail);  
    }  
  
}
```

nacos / seata启动  
先启动product 再启动front  
访问10004测试,测试上面四个控制器模块的方法