
## 开发持久层

*OmsCartMapper* 添加方法如下：
```java
/**  
 * 根据当前登录用户id查询次用户购物车中所有sku信息  
 *  
 * @param userId 用户id  
 * @return sku信息  
 */  
List<CartStandardVO> selectCartByUserId(Long userId);
```

*OmsCartMapper.xml* 添加对应内容
```xml
<!--   
    Mybatis框架有默认的映射规则  
    数据中下划线规则会按驼峰命名规则转换    
    例如：    
    列名          属性名  
    id            id    
    user_id       userId 
    sku_id        skuId  
	title         title
-->
<!-- 根据当前登录用户id查询用户购物车中所有sku信息 -->  
<!-- List<CartStandardVO> selectCartByUserId(Long userId); -->  
<select id="selectCartByUserId" resultType="cn.tedu.mall.pojo.order.vo.CartStandardVO">  
    SELECT    
    <include refid="SimpleQueryFields"/>  
    FROM oms_cart    
    WHERE user_id = #{userId}
</select>
```

## 开发业务逻辑层

*OmsCartServiceImpl* 业务实现  
  
返回值支持分页结果，按 *分页条件查询*：
```java
@Override  
public JsonPage<CartStandardVO> listCarts(Integer page, Integer pageSize) {  
    // 先从SpringSecurity上下文中获取当前登录用户id  
    Long userId = getUserId();  
  
    // 在执行查询之前，先设置分页查询的条件  
    PageHelper.startPage(page, pageSize);  
    // 上面设置了分页条件，下面查询会生成limit关键字查询指定区域的数据  
    List<CartStandardVO> list = omsCartMapper.selectCartByUserId(userId);  
  
    // 返回JsonPage类型对象  
    return JsonPage.restPage(new PageInfo<>(list));  
}
```


## 开发控制器层

*OmsCartController* 添加方法如下：
```java
@GetMapping("/list")  
@ApiOperation("查询当前用户的购物车列表")  
@PreAuthorize("hasAuthority('ROLE_user')")  
@ApiImplicitParams({  
        @ApiImplicitParam(name = "page", value = "页码", example = "1"),  
        @ApiImplicitParam(name = "pageSize", value = "每页条数", example = "2")  
})  
public JsonResult<JsonPage<CartStandardVO>> listCartByPage(  
        @RequestParam(required = false, defaultValue = WebConsts.DEFAULT_PAGE) Integer page,  
        @RequestParam(required = false, defaultValue = WebConsts.DEFAULT_PAGE_SIZE) Integer pageSize) {  
    
    JsonPage<CartStandardVO> list = omsCartService.listCarts(page, pageSize);  
    return JsonResult.ok(list);  
}
```

` @RequestParam(required = false, defaultValue = "1")`：表示该参数 *可以为空*，且 *默认值* 为1。


## 测试

在上面测试了新增购物车环境的基础上  

重启order模块  
再次测试 http://localhost:10005/doc.html