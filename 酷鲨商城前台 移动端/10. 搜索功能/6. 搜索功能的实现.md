
电商网站一定会有按用户输入的 *关键字* 进行搜索的功能  
  
这样的搜索都是搜索ES查询到的结果  

上面操作中，我们*已经将所有spu信息保存到了ES中*
  
下面通过查询逻辑将搜索结果显示出来：


## 编写SpringData自定义查询

如果我们按照关键字"手机"进行搜索  
  
可以在Repository接口中编写自定义方法搜索 *title字段包含"手机"* 的数据
```java
// 自定义查询：title字段包含指定关键词（分词）  
Iterable<SpuForElastic> querySpuForElasticsByTitleMatches(String title);
```

上面的查询可以通过测试类测试：
```java
// 自定义查询  
@Test  
void queryTitle() {  
  
    Iterable<SpuForElastic> spus = spuRepository.querySpuForElasticsByTitleMatches("华为电脑");  
  
    spus.forEach(spu -> System.out.println(spu));  
}
```

尤其需要关注ES是否已经启动  
  
不需要其它项目的支持，直接运行测试即可


<hr>

## 自定义查询 时 编写查询语句，避免方法名过长

我们业务中需要4个字段的条件查询，是 *可以通过方法名称的编写实现* 的
  
*SpringData也支持* 我们在**代码中编写查询语句**，*以避免过长的方法名*。
  
*SpuForElasticRepository*添加方法：
```java
@Query("{\n" +  
        "    \"bool\": {\n" +  
        "      \"should\": [\n" +  
        "        { \"match\": {\"name\": \"?0\"}},\n" +  
        "        { \"match\": {\"title\": \"?0\"}},\n" +  
        "        { \"match\": {\"description\": \"?0\"}},\n" +  
        "        { \"match\": {\"category_name\": \"?0\"}}\n" +  
        "      ]\n" +  
        "    }\n" +  
        "  }")  
    // 上面指定类查询语句，我们的方法名就可以脱离严格的规范，来任意起名了（见名知意即可）  
    /*  
        当运行这个方法时，就会运行上面的查询语句，语句中的?0的位置就是参数的占位符  
        因为我们查询的4个字段都是同一个分词，都写?0，所以只需要一个参数  
     */
    Iterable<SpuForElastic> querySearch(String keyword);
```


测试代码：
```java
@Test  
void querySearch() {  
    Iterable<SpuForElastic> spus = spuRepository.querySearch("华为手机");  
  
    spus.forEach(spu -> System.out.println(spu));  
}
```


<hr>


## 实际运行的查询的逻辑是需要分页的

所以要按照 *SpringData支持的 分页查询格式* 修改上面的查询代码

```java
@Query("{\n" +  
        "    \"bool\": {\n" +  
        "      \"should\": [\n" +  
        "        { \"match\": {\"name\": \"?0\"}},\n" +  
        "        { \"match\": {\"title\": \"?0\"}},\n" +  
        "        { \"match\": {\"description\": \"?0\"}},\n" +  
        "        { \"match\": {\"category_name\": \"?0\"}}\n" +  
        "      ]\n" +  
        "    }\n" +  
        "  }")  
    // 上面指定类查询语句，我们的方法名就可以脱离严格的规范，来任意起名了（见名知意即可）  
  
    /*  
        当运行这个方法时，就会运行上面的查询语句，语句中的?0的位置就是参数的占位符  
        因为我们查询的4个字段都是同一个分词，都写?0，所以只需要一个参数  
     */
    //↓↓                                            ↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓
    Page<SpuForElastic> querySearch(String keyword, Pageable pageable);
```

修改了方法的定义，原有的调用会报错，注释掉测试中的调用代码即可!
```java
@Test  
void querySearch() {  
    // Iterable<SpuForElastic> spus = spuRepository.querySearch("华为手机");  
    Iterable<SpuForElastic> spus = spuRepository.querySearch("手机", PageRequest.of(1, 2));  
  
    spus.forEach(spu -> System.out.println(spu));  
}
```

