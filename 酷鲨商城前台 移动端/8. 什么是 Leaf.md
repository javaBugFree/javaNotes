
leaf 是叶子的意思。

我们使用的Leaf是 *美团公司* **开源** 的一个*分布式序列号(id)生成系统*。
  
我们可以在Github网站上下载项目直接使用。

在其他项目中也可以直接使用


## 为什么需要Leaf

![[为什么需要Leaf.png]]

上面的图片中，是一个实际开发中常见的 **读写分离** 的 *数据库部署格式*。
  
专门进行 *数据更新(写)* 的有两个数据库节点（*在两个服务器上*）

它们 **同时新增数据** *可能产生相同的* **自增列id**，
一旦生成相同的id，数据同步就会有问题，*会产生id冲突*，甚至引发异常。
  
我们 *为了* 在这种 *多数据库节点的环境下* 能够产生 *唯一id*。

可以使用Leaf来生成


## Leaf的工作原理

Leaf底层支持通过 "**雪花算法**" 生成不同id，

我们使用的是 *单纯的序列*。
要想使用，需要 *事先设置好* **leaf的起始值** 和 **缓存id数**。
  
举例，从1000开始缓存500
也就是从id1000~1499这些值，都会保存在Leaf的内存中，当有服务需要时，直接取出下一个值。

*取出过的值不会再次生成*，当缓存的数据取完时，会往后再缓存500个，从1500-1999。
![[Leaf的工作原理.png]]

leaf要想 *设置 起始值和缓存数*，
需要给leaf创建一个 **指定格式** 的 *数据库表*，
运行过程中会 *从数据库表获取信息*。
我们当前的信息保存在leafdb.leaf_alloc表中。