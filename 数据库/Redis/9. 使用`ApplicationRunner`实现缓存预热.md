
在Spring Boot项目中，任何 **组件类** *实现`ApplicationRunner`接口*，*重写*其中的`run()`方法，此方法会在 **项目启动之后** *自动执行*。  
  
在项目的根包下创建`preload.CachePreload`类，在类上添加`@Component`注解，并实现`ApplicationRunner`接口，例如：  
```java  
package com.example.csmall.product02.preload;

/**  
 * 缓存预热  
 */  
@Slf4j  
@Component  
public class cachePreload implements ApplicationRunner {  
	  
    @Autowired  
    AlbumMapper albumMapper;  
    @Autowired  
    AlbumRedisRepository albumRedisRepository;  
	  
    @Override  
    public void run(ApplicationArguments args) throws Exception {  
        log.debug("开始执行CachePreload.run()");  
		
		// 获取数据之前，把之前的数据删除掉  
		albumRedisRepository.deleteList();
		
        List<AlbumListItemVO> list = albumMapper.list();  
        albumRedisRepository.save(list);  
    }  
}
```

启动项目后，可以看到，以上`run()`方法在项目*启动完成之后*自动执行了。


*不过*，按照之前的风格，Mapper和Repository应该*只能由Service来调用*，所以，应对以上代码进行修改，即*手动更新*。

1. *AlbumService*添加抽象方法。
```java
/**  
 * 重建缓存  
 */  
void rebuildCache();
```

2. *AlbumServiceImpl*实现以上方法
```java
// 重建缓存  
@Override  
public void rebuildCache() {  
    log.debug("开始处理【相册数据的缓存预热】的业务，无参数");  
  
    // 获取数据之前，删除缓存中的相册列表  
    albumRedisRepository.deleteList();  
    // 从数据库中查询所有相册的列表  
    List<AlbumListItemVO> list = albumMapper.list();  
    // 将相册列表写入到缓存中  
    albumRedisRepository.save(list);  
  
    // 获取数据之前，删除缓存中的相册的数据项  
    albumRedisRepository.deleteAllItem();  
    // 遍历相册列表的数据  
    for (AlbumListItemVO albumListItemVO : list) {  
        // 获取每个相册数据的ID，并根据此ID从数据库中查询相册的详情  
        AlbumStandardVO albumStandardVO = albumMapper.getStandardById(albumListItemVO.getId());  
        // 将每一个相册详情写入到缓存中  
        albumRedisRepository.save(albumStandardVO);  
    }  
}
```

3. 当使用计划任务时，此步废弃。而*CachePreload*则直接调用*albumService*的抽象方法
```java
/**  
 * 缓存预热  
 */  
@Slf4j  
@Component  
public class cachePreload implements ApplicationRunner {  
  
    @Autowired  
    AlbumService albumService;  
  
    @Override  
    public void run(ApplicationArguments args) throws Exception {  
        log.debug("开始执行CachePreload.run()");  
  
        albumService.rebuildCache();  
    }  
}
```

4. *AlbumController* 处理*重建相册缓存*的请求
```java
// http://localhost:8090/albums/rebuild-cache  
@PostMapping("/rebuild-cache")  
@PreAuthorize("hasAuthority('/pms/product/update')")  
@ApiOperation("重建相册缓存")  
@ApiOperationSupport(order = 900)  
public JsonResult<Void> rebuildCache(){  
    log.debug("开始处理【重建相册缓存】的请求，无参数");  
    albumService.rebuildCache();  
    return JsonResult.success();  
}
```