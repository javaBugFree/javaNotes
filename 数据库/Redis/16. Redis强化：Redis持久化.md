
Redis将信息保存在内存

内存的特征就是：*一旦断电*，**所有信息都丢失**，
对于Redis而言，所有数据丢失后，再*重新加载数据*，就需要从数据库重新查询所有数据,这个操作*不但耗费时间*，*而且对数据库的压力也非常大*。

而且*有些业务*是*先将数据保存在Redis*，*隔一段时间* 和数据库 *同步* 的，如果Redis断电，这段时间的数据就完全丢失了！
  
*为了防止*Redis的重启对数据库带来额外的压力和数据的丢失，**Redis支持了持久化的功能**  
。
所谓持久化就是 **将Redis中保存的数据**，**以指定方式** *保存在Redis 当前服务器* 的 ***硬盘上***。

如果存在硬盘上，那么断电数据也不会丢失，*再启动Redis时*，**利用硬盘中的信息 来恢复数据**。
  
Redis实现持久化有两种策略：

## RDB：(Redis Database Backup)  
  
RDB本质上就是 **数据库快照**（就是 *当前Redis中所有数据* **转换成二进制的对象**，*保存在硬盘上*）。
  
*默认*情况下，每次备份会 **生成一个 dump.rdb 的文件**  
  
当Redis断电或宕机后，重新启动时，会从这个文件中恢复数据，获得dump.rdb中所有内容。
  
实现这个效果我们可以在 **Redis的配置文件** 中 *添加如下信息*：
```
save 60 5
```
上面配置中60表示秒，
5表示Redis的key被更新的次数。

*配置效果*：1分钟内如果有5个及以上的key被更新，就启动rdb数据库快照程序  
  
**优点**：
- 因为是整体Redis数据的二进制格式，数据恢复是 **整体恢复** 的。
**缺点**：
- 生成的rdb文件是一个 *硬盘上的文件*（最少几百兆），生成时对Redis的 *工作性能* 有影响。
- 如果突然断电，只能恢复到 *最后一次* 生成的rdb中的数据。


## AOF(Append Only File):  
  
AOF策略是将Redis **运行过的 所有命令(日志)备份** 下来，保存在 **硬盘上**。
  
这样即使Redis断电，我们也可以 *根据运行过的日志*，**恢复为断电前的样子**。
  
我们可以在Redis的配置文件中添加如下配置信息：
```
appendonly yes
```
经过这个设置，就能保存运行过的指令的日志了。
理论上任何运行过的指令都可以恢复。

但是实际情况下，Redis*非常繁忙时*，我们会 **将日志命令缓存之后**，*整体发送给备份*，**减少io次数** 以 *提高备份的性能* 和 *减少对Redis性能的影响*。
  
实际开发中，配置一般会采用 *每秒* 将日志文件发送一次的策略，断电*最多丢失1秒数据*。
  
**优点**：
- 相对RDB来讲，*信息丢失的较少*。
**缺点**:  
- 因为保存的是运行的日志，所以*占用空间较大*。

实际开发中RDB和AOF是 *可以同时开启* 的，*也可以选择性开启*。

> Redis的AOF *为减少日志文件的大小*，支持 **AOF rewrite**。
>  
> 简单来说就是将日志中无效的语句（创建后又删除）删除，能够减少占用的空间。